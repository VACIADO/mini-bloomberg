<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini Bloomberg | CFD SintÃ©tico EUR vs USD</title>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
body {
  margin: 0;
  background: #0b0f14;
  color: #e5e7eb;
  font-family: Arial, sans-serif;
}
header {
  padding: 10px;
  text-align: center;
  background: #111827;
  border-bottom: 1px solid #1f2937;
}
#container {
  display: flex;
  flex-direction: column;
  height: 100vh;
}
#chart {
  flex: 1;
}
footer {
  padding: 6px;
  font-size: 12px;
  background: #111827;
  border-top: 1px solid #1f2937;
  text-align: center;
  color: #9ca3af;
}
.panel {
  display: flex;
  gap: 15px;
  padding: 8px;
  background: #020617;
  font-size: 13px;
}
.panel div {
  opacity: 0.9;
}
.up { color: #22c55e; }
.down { color: #ef4444; }
</style>
</head>

<body>
<header>
  ðŸ”¥ MINI BLOOMBERG â€” CFD SINTÃ‰TICO (EUR vs USD)
</header>

<div class="panel">
  <div>CFD: <span id="cfdPrice">100.00</span></div>
  <div>SesiÃ³n: <span id="session">EU</span></div>
  <div>Bias: <span id="bias">Neutral</span></div>
</div>

<div id="container">
  <div id="chart"></div>
</div>

<footer>
  CFD sintÃ©tico propio Â· Velas dinÃ¡micas Â· Base IA + Noticias
</footer>

<script>
/* ================================
   CONFIGURACIÃ“N GENERAL
================================ */

const BASE_PRICE = 100;
let currentPrice = BASE_PRICE;
let lastClose = BASE_PRICE;

const weights = {
  EUR: {
    bondsEU: 0.3,
    exy: 0.3,
    gold: 0.2,
    btc: 0.2
  },
  USD: {
    dxy: 0.35,
    us10y: 0.25,
    sp500: 0.2,
    vix: 0.2
  }
};

/* ================================
   CHART PRO (TradingView Style)
================================ */

const chart = LightweightCharts.createChart(document.getElementById('chart'), {
  layout: {
    background: { color: '#0b0f14' },
    textColor: '#e5e7eb',
  },
  grid: {
    vertLines: { color: '#1f2937' },
    horzLines: { color: '#1f2937' },
  },
  crosshair: {
    mode: LightweightCharts.CrosshairMode.Normal,
  },
  timeScale: {
    timeVisible: true,
    secondsVisible: true,
  },
  rightPriceScale: {
    borderColor: '#374151',
  },
});

const candleSeries = chart.addCandlestickSeries({
  upColor: '#22c55e',
  downColor: '#ef4444',
  borderUpColor: '#22c55e',
  borderDownColor: '#ef4444',
  wickUpColor: '#22c55e',
  wickDownColor: '#ef4444',
});

/* ================================
   CFD SINTÃ‰TICO (LÃ“GICA)
================================ */

function randomMove(strength = 1) {
  return (Math.random() - 0.5) * strength;
}

function calcEURPower() {
  return (
    randomMove(weights.EUR.bondsEU) +
    randomMove(weights.EUR.exy) +
    randomMove(weights.EUR.gold) +
    randomMove(weights.EUR.btc)
  );
}

function calcUSDPower() {
  return (
    randomMove(weights.USD.dxy) +
    randomMove(weights.USD.us10y) +
    randomMove(weights.USD.sp500) +
    randomMove(weights.USD.vix)
  );
}

function generateCandle() {
  const eurPower = calcEURPower();
  const usdPower = calcUSDPower();

  const delta = eurPower - usdPower;

  const open = lastClose;
  const close = open + delta;
  const high = Math.max(open, close) + Math.random();
  const low = Math.min(open, close) - Math.random();

  lastClose = close;

  currentPrice = close;
  updatePanel(delta);

  return {
    time: Math.floor(Date.now() / 1000),
    open,
    high,
    low,
    close
  };
}

/* ================================
   PANEL INFO
================================ */

function updatePanel(delta) {
  const priceEl = document.getElementById('cfdPrice');
  priceEl.textContent = currentPrice.toFixed(2);
  priceEl.className = delta >= 0 ? 'up' : 'down';

  document.getElementById('bias').textContent =
    delta > 0.2 ? 'EUR fuerte' :
    delta < -0.2 ? 'USD fuerte' :
    'Neutral';
}

/* ================================
   LOOP DE MERCADO (VELAS VIVAS)
================================ */

setInterval(() => {
  const candle = generateCandle();
  candleSeries.update(candle);
}, 2000);

/* ================================
   BASE PARA ALERTAS / IA
================================ */

// EJEMPLO: rotura simple
function checkBreakout() {
  if (currentPrice > BASE_PRICE + 5) {
    console.log('ðŸš¨ Posible ruptura alcista EUR');
  }
  if (currentPrice < BASE_PRICE - 5) {
    console.log('ðŸš¨ Posible ruptura bajista USD');
  }
}

setInterval(checkBreakout, 5000);

</script>
</body>
</html>
