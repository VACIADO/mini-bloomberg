<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini Bloomberg Pro</title>
<style>
body { 
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #121212;
  color: #fff;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
  justify-content: center;
}

.panel {
  border: 1px solid #444;
  border-radius: 8px;
  background-color: #1e1e1e;
  box-sizing: border-box;
  padding: 10px;
  flex: 1 1 45%;
  min-width: 300px;
  display: flex;
  flex-direction: column;
  height: 420px;
}

h2 {
  margin: 0 0 5px 0;
  text-align: center;
  font-size: 1.1rem;
}

.tradingview-widget-container {
  flex: 1;
  margin-top: 5px;
  border-radius: 6px;
  overflow: hidden;
}

#ia-console {
  width: 100%;
  background: #000;
  color: #0f0;
  font-family: monospace;
  padding: 6px;
  height: 120px;
  overflow-y: auto;
  font-size: 0.8rem;
  margin-top: 8px;
  border-radius: 4px;
  border: 1px solid #444;
}

.cfd-controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
}

.cfd-controls select {
  background: #333;
  color: #fff;
  border: 1px solid #555;
  border-radius: 4px;
  padding: 3px;
  font-size: 0.9rem;
}
</style>
</head>
<body>

<!-- PANEL EURO / CORRELADOS -->
<div class="panel" id="panel-eurodolar">
<h2>Euro / Correlados</h2>
<div class="tradingview-widget-container" id="tv_eurodolar"></div>
<div class="tradingview-widget-container" id="tv_bono_eu"></div>
<div class="tradingview-widget-container" id="tv_oro"></div>
<div class="tradingview-widget-container" id="tv_brent"></div>
<div class="tradingview-widget-container" id="tv_btc"></div>
</div>

<!-- PANEL DXY / CORRELADOS -->
<div class="panel" id="panel-dxy">
<h2>DXY / Correlados</h2>
<div class="tradingview-widget-container" id="tv_dxy"></div>
<div class="tradingview-widget-container" id="tv_bono_us"></div>
<div class="tradingview-widget-container" id="tv_nasdaq"></div>
<div class="tradingview-widget-container" id="tv_sp500"></div>
<div class="tradingview-widget-container" id="tv_vix"></div>
</div>

<!-- PANEL CFD POLMILLONE -->
<div class="panel" id="panel-cfd">
<h2>CFD ‚Äì Polmillone</h2>

<!-- Controles del gr√°fico CFD -->
<div class="cfd-controls">
  <label>Tipo de vela:
    <select id="cfd_style" onchange="updateCFDStyle()">
      <option value="candles">Velas Japonesas</option>
      <option value="bars">Barras</option>
      <option value="line">L√≠nea</option>
    </select>
  </label>
  <label>Intervalo:
    <select id="cfd_interval" onchange="updateCFDInterval()">
      <option value="1">1 Min</option>
      <option value="5">5 Min</option>
      <option value="15">15 Min</option>
      <option value="60">1 Hora</option>
    </select>
  </label>
</div>

<div class="tradingview-widget-container" id="tv_cfd"></div>
<div id="ia-console">Consola de IA activa... Analizando correlaciones en tiempo real.</div>
</div>

<!-- TradingView JS -->
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
// Funci√≥n para crear widgets normales
function crearWidget(symbol, containerId) {
  document.getElementById(containerId).innerHTML = "";
  new TradingView.widget({
    container_id: containerId,
    symbol: symbol,
    interval: "60",
    timezone: "Europe/Madrid",
    theme: "dark",
    style: "1",
    locale: "es",
    hide_top_toolbar: true,
    width: "100%",
    height: "100%"
  });
}

// Funci√≥n para escribir en consola
function logConsole(text) {
  const c = document.getElementById("ia-console");
  c.innerText += "\n" + text;
  c.scrollTop = c.scrollHeight;
}

// Inicializaci√≥n de todos los gr√°ficos normales
const widgets = {
  tv_eurodolar: "FX:EURUSD",
  tv_bono_eu: "INDEX:EXY",
  tv_oro: "OANDA:XAUUSD",  
  tv_brent: "TVC:UKOIL",
  tv_btc: "BINANCE:BTCUSDT",
  tv_dxy: "INDEX:DXY",
tv_bono_us: "US10Y",
  tv_nasdaq: "NASDAQ:NDX",
tv_sp500: "OANDA:SPX500USD",
tv_vix: "CAPITALCOM:VIX",
};

for (const id in widgets) {
  crearWidget(widgets[id], id);
}

// ‚úÖ CFD ‚Äì Polmillone (gr√°fico profesional simulado)
let cfdData = [];
let cfdPrice = 100; // precio inicial
let cfdInterval = 1;
let cfdStyle = 'candles';

function initCFD() {
  for (let i = 0; i < 50; i++) {
    const change = (Math.random() - 0.5) * 2;
    cfdPrice += change;
    cfdData.push({ time: i, value: cfdPrice });
  }
  drawCFD();
}

function drawCFD() {
  const container = document.getElementById("tv_cfd");
  container.innerHTML = "";

  const canvas = document.createElement("canvas");
  canvas.width = container.clientWidth;
  canvas.height = container.clientHeight;
  container.appendChild(canvas);
  const ctx = canvas.getContext("2d");

  const padding = 40;
  const width = canvas.width - padding * 2;
  const height = canvas.height - padding * 2;

  const values = cfdData.map(d => d.value);
  const max = Math.max(...values);
  const min = Math.min(...values);

  // Dibujar l√≠neas o velas
  for (let i = 0; i < cfdData.length; i++) {
    const x = padding + (i / (cfdData.length - 1)) * width;
    const y = padding + ((max - cfdData[i].value) / (max - min)) * height;

    if (cfdStyle === 'line') {
      if (i > 0) {
        ctx.beginPath();
        const prevX = padding + ((i-1)/(cfdData.length-1))*width;
        const prevY = padding + ((max - cfdData[i-1].value)/(max-min))*height;
        ctx.moveTo(prevX, prevY);
        ctx.lineTo(x, y);
        ctx.strokeStyle = "#00ff00";
        ctx.stroke();
      }
    } else if (cfdStyle === 'bars' || cfdStyle === 'candles') {
      const barWidth = width / cfdData.length * 0.6;
      ctx.fillStyle = (i>0 && cfdData[i].value>cfdData[i-1].value) ? "#0f0" : "#f00";
      ctx.fillRect(x - barWidth/2, y, barWidth, canvas.height - padding - y);
      if (cfdStyle === 'candles') {
        ctx.fillRect(x - barWidth/4, y, barWidth/2, 2); // mecha simulada
      }
    }
  }

  // Ejes
  ctx.strokeStyle = "#888";
  ctx.beginPath();
  ctx.moveTo(padding, padding);
  ctx.lineTo(padding, canvas.height - padding);
  ctx.lineTo(canvas.width - padding, canvas.height - padding);
  ctx.stroke();

  // Escala precio lateral
  ctx.fillStyle = "#fff";
  ctx.font = "12px monospace";
  ctx.fillText(max.toFixed(2), 5, padding);
  ctx.fillText(min.toFixed(2), 5, canvas.height - padding);

  // Escala tiempo
  ctx.fillText("0", padding, canvas.height - 5);
  ctx.fillText(cfdData.length-1, canvas.width - padding - 10, canvas.height - 5);
}

function updateCFD() {
  const change = (Math.random() - 0.5) * 2;
  cfdPrice += change;
  cfdData.push({ time: cfdData.length, value: cfdPrice });
  if (cfdData.length > 50) cfdData.shift();
  drawCFD();
}

function updateCFDInterval() {
  const sel = document.getElementById("cfd_interval");
  cfdInterval = parseInt(sel.value);
}

function updateCFDStyle() {
  const sel = document.getElementById("cfd_style");
  cfdStyle = sel.value;
  drawCFD();
}

initCFD();
setInterval(updateCFD, 2000);

// Simulaci√≥n de IA
setInterval(() => {
  const mensajes = [
    "EUR/USD y DXY correlaci√≥n negativa detectada üìâ",
    "BTC sigue tendencia alcista con volatilidad alta üöÄ",
    "S&P500 y Nasdaq muestran movimientos sincronizados üìä",
    "Brent y Oro sin correlaci√≥n significativa ‚öñÔ∏è"
  ];
  logConsole(mensajes[Math.floor(Math.random() * mensajes.length)]);
}, 8000);
</script>

</body>
</html>
