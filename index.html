<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini Bloomberg Pro</title>
<style>
body { 
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #121212;
  color: #fff;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
  justify-content: center;
}
.panel {
  border: 1px solid #444;
  border-radius: 8px;
  background-color: #1e1e1e;
  box-sizing: border-box;
  padding: 10px;
  flex: 1 1 45%;
  min-width: 300px;
  display: flex;
  flex-direction: column;
  height: 420px;
}
h2 {
  margin: 0 0 5px 0;
  text-align: center;
  font-size: 1.1rem;
}
.tradingview-widget-container {
  flex: 1;
  margin-top: 5px;
  border-radius: 6px;
  overflow: hidden;
}
#ia-console {
  width: 100%;
  background: #000;
  color: #0f0;
  font-family: monospace;
  padding: 6px;
  height: 120px;
  overflow-y: auto;
  font-size: 0.8rem;
  margin-top: 8px;
  border-radius: 4px;
  border: 1px solid #444;
}
.cfd-controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
}
.cfd-controls select {
  background: #333;
  color: #fff;
  border: 1px solid #555;
  border-radius: 4px;
  padding: 3px;
  font-size: 0.9rem;
}
</style>
</head>

<body>

<!-- PANEL EURO -->
<div class="panel">
<h2>Euro / Correlados</h2>
<div id="tv_eurodolar" class="tradingview-widget-container"></div>
<div id="tv_bono_eu" class="tradingview-widget-container"></div>
<div id="tv_oro" class="tradingview-widget-container"></div>
<div id="tv_brent" class="tradingview-widget-container"></div>
<div id="tv_btc" class="tradingview-widget-container"></div>
</div>

<!-- PANEL DÓLAR -->
<div class="panel">
<h2>Dólar / Correlados</h2>
<div id="tv_dxy" class="tradingview-widget-container"></div>
<div id="tv_bono_us" class="tradingview-widget-container"></div>
<div id="tv_nasdaq" class="tradingview-widget-container"></div>
<div id="tv_sp500" class="tradingview-widget-container"></div>
<div id="tv_vix" class="tradingview-widget-container"></div>
</div>

<!-- PANEL CFD -->
<div class="panel">
<h2>CFD – Polmillone</h2>

<div class="cfd-controls">
  <select id="cfd_style" onchange="updateCFDStyle()">
    <option value="candles">Velas</option>
    <option value="bars">Barras</option>
    <option value="line">Línea</option>
  </select>
</div>

<div id="tv_cfd" class="tradingview-widget-container"></div>
<div id="ia-console">Filtro activo...</div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
// =====================
// TRADINGVIEW WIDGETS
// =====================
function crearWidget(symbol, id) {
  new TradingView.widget({
    container_id: id,
    symbol: symbol,
    interval: "60",
    timezone: "Europe/Madrid",
    theme: "dark",
    style: "1",
    locale: "es",
    hide_top_toolbar: true,
    width: "100%",
    height: "100%"
  });
}

const widgets = {
  tv_eurodolar: "FX:EURUSD",
  tv_bono_eu: "INDEX:EXY",
  tv_oro: "OANDA:XAUUSD",
  tv_brent: "TVC:UKOIL",
  tv_btc: "BINANCE:BTCUSDT",
  tv_dxy: "INDEX:DXY",
  tv_bono_us: "US10Y",
  tv_nasdaq: "NASDAQ:NDX",
  tv_sp500: "OANDA:SPX500USD",
  tv_vix: "CAPITALCOM:VIX"
};

Object.keys(widgets).forEach(id => crearWidget(widgets[id], id));

// =====================
// CONSOLA
// =====================
function logConsole(txt) {
  const c = document.getElementById("ia-console");
  c.innerText += "\n" + txt;
  c.scrollTop = c.scrollHeight;
}

// =====================
// FILTRO DE PRESIÓN
// =====================
const filterConfig = {
  euro: {
    eurusd: 1.5,
    bono: 1.0,
    oro: 1.2,
    brent: 0.8,
    btc: 0.6
  },
  dolar: {
    dxy: 1.5,
    bono: 1.0,
    nasdaq: 1.0,
    sp: 1.0,
    vix: -1.3
  }
};

function readDirection() {
  return (Math.random() - 0.5) * 2;
}

function runFilter() {
  let euro = 0;
  let dolar = 0;

  Object.values(filterConfig.euro).forEach(w => euro += readDirection() * w);
  Object.values(filterConfig.dolar).forEach(w => dolar += readDirection() * w);

  const delta = euro - dolar;

  logConsole(`EURO ${euro.toFixed(2)} | USD ${dolar.toFixed(2)} | Δ ${delta.toFixed(2)}`);
  return delta;
}

// =====================
// CFD GRÁFICO
// =====================
let cfdData = [];
let cfdPrice = 100;
let cfdStyle = "candles";

function initCFD() {
  for (let i = 0; i < 50; i++) {
    cfdPrice += (Math.random() - 0.5);
    cfdData.push(cfdPrice);
  }
  drawCFD();
}

function drawCFD() {
  const container = document.getElementById("tv_cfd");
  container.innerHTML = "";
  const canvas = document.createElement("canvas");
  canvas.width = container.clientWidth;
  canvas.height = container.clientHeight;
  container.appendChild(canvas);
  const ctx = canvas.getContext("2d");

  const pad = 30;
  const max = Math.max(...cfdData);
  const min = Math.min(...cfdData);

  cfdData.forEach((v, i) => {
    const x = pad + i * (canvas.width - pad * 2) / cfdData.length;
    const y = pad + (max - v) / (max - min) * (canvas.height - pad * 2);
    const prev = cfdData[i - 1] || v;

    if (cfdStyle === "line") {
      if (i > 0) {
        ctx.strokeStyle = "#0f0";
        ctx.beginPath();
        ctx.moveTo(x - 10, pad + (max - prev) / (max - min) * (canvas.height - pad * 2));
        ctx.lineTo(x, y);
        ctx.stroke();
      }
    } else {
      ctx.fillStyle = v >= prev ? "#0f0" : "#f00";
      ctx.fillRect(x, y, 4, canvas.height - pad - y);
    }
  });
}

function updateCFD() {
  const delta = runFilter();
  cfdPrice += delta * 0.6;
  cfdData.push(cfdPrice);
  if (cfdData.length > 60) cfdData.shift();
  drawCFD();
}

function updateCFDStyle() {
  cfdStyle = document.getElementById("cfd_style").value;
  drawCFD();
}

initCFD();
setInterval(updateCFD, 2000);
</script>

</body>
</html>
