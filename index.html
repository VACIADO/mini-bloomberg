<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini Bloomberg Pro â€“ CFD Real Time</title>
<style>
body { 
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #121212;
  color: #fff;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
  justify-content: center;
}
.panel {
  border: 1px solid #444;
  border-radius: 8px;
  background-color: #1e1e1e;
  box-sizing: border-box;
  padding: 10px;
  flex: 1 1 45%;
  min-width: 300px;
  display: flex;
  flex-direction: column;
  height: 420px;
}
h2 { margin: 0 0 5px 0; text-align: center; font-size: 1.1rem; }
.tradingview-widget-container { flex: 1; margin-top: 5px; border-radius: 6px; overflow: hidden; }
#ia-console { width: 100%; background: #000; color: #0f0; font-family: monospace; padding: 6px; height: 150px; overflow-y: auto; font-size: 0.8rem; margin-top: 8px; border-radius: 4px; border: 1px solid #444; }
.cfd-controls { display: flex; justify-content: space-between; margin-bottom: 5px; }
.cfd-controls select { background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 3px; font-size: 0.9rem; }
.news-panel { flex:1 1 45%; background:#121921; padding:10px; border-radius:6px; max-height:180px; overflow-y:auto; margin-top:5px;}
.news-panel h3{ margin:0 0 5px 0; font-size:14px; }
.news{margin-bottom:6px;} 
.news span{font-weight:bold;} 
.alert{background:#7c2d12;color:#fff;padding:6px;text-align:center;font-weight:bold;margin:4px 0;border-radius:4px;}
</style>
</head>
<body>

<!-- PANEL EURO / CORRELADOS -->
<div class="panel" id="panel-eurodolar">
<h2>Euro / Correlados</h2>
<div class="tradingview-widget-container" id="tv_eurodolar"></div>
<div class="tradingview-widget-container" id="tv_bono_eu"></div>
<div class="tradingview-widget-container" id="tv_oro"></div>
<div class="tradingview-widget-container" id="tv_brent"></div>
<div class="tradingview-widget-container" id="tv_btc"></div>
</div>

<!-- PANEL DXY / CORRELADOS -->
<div class="panel" id="panel-dxy">
<h2>DXY / Correlados</h2>
<div class="tradingview-widget-container" id="tv_dxy"></div>
<div class="tradingview-widget-container" id="tv_bono_us"></div>
<div class="tradingview-widget-container" id="tv_nasdaq"></div>
<div class="tradingview-widget-container" id="tv_sp500"></div>
<div class="tradingview-widget-container" id="tv_vix"></div>
</div>

<!-- PANEL CFD REAL-TIME -->
<div class="panel" id="panel-cfd">
<h2>CFD SintÃ©tico â€“ Real Time</h2>
<div class="cfd-controls">
  <label>Intervalo:
    <select id="cfd_interval" onchange="updateCFDInterval()">
      <option value="1">1 Min</option>
      <option value="5">5 Min</option>
      <option value="15">15 Min</option>
      <option value="60">1 Hora</option>
    </select>
  </label>
  <label>Estilo:
    <select id="cfd_style" onchange="updateCFDStyle()">
      <option value="candles">Velas Japonesas</option>
      <option value="line">LÃ­nea</option>
    </select>
  </label>
</div>
<div id="tv_cfd" style="flex:1; min-height:250px;"></div>
<div id="ia-console">Consola IA activa... Analizando soporte y resistencia del EUR/USD.</div>
<div class="news-panel" id="news-before"><h3>Noticias Antes</h3></div>
<div class="news-panel" id="news-after"><h3>Noticias DespuÃ©s</h3></div>
<div id="alertBox"></div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<script>
// ===== TRADINGVIEW WIDGETS =====
function crearWidget(symbol, containerId){
  document.getElementById(containerId).innerHTML="";
  new TradingView.widget({
    container_id: containerId,
    symbol: symbol,
    interval: "60",
    timezone: "Europe/Madrid",
    theme: "dark",
    style: "1",
    locale: "es",
    hide_top_toolbar: true,
    width: "100%",
    height: "100%"
  });
}

const widgets={
  tv_eurodolar:"FX:EURUSD",
  tv_bono_eu:"INDEX:EXY",
  tv_oro:"OANDA:XAUUSD",  
  tv_brent:"TVC:UKOIL",
  tv_btc:"BINANCE:BTCUSDT",
  tv_dxy:"INDEX:DXY",
  tv_bono_us:"US10Y",
  tv_nasdaq:"NASDAQ:NDX",
  tv_sp500:"OANDA:SPX500USD",
  tv_vix:"CAPITALCOM:VIX",
};
for(const id in widgets) crearWidget(widgets[id],id);

// ===== CFD SINTÃ‰TICO PROFESIONAL =====
let cfdChart, cfdSeries, cfdData=[], lastClose=100, cfdInterval=1, cfdStyle='candles';

const euroAssets=["tv_eurodolar","tv_bono_eu","tv_oro","tv_brent","tv_btc"];
const dollarAssets=["tv_dxy","tv_bono_us","tv_nasdaq","tv_sp500","tv_vix"];

let pesosEuro={ tv_eurodolar:1, tv_bono_eu:0.8, tv_oro:0.5, tv_brent:0.3, tv_btc:0.2 };
let pesosDollar={ tv_dxy:1, tv_bono_us:0.8, tv_nasdaq:0.6, tv_sp500:0.6, tv_vix:0.4 };
let precios={};
for(const id of [...euroAssets,...dollarAssets]) precios[id]=100+Math.random()*10;

function calcularCFD(){
  let sumEuro=0,totalPesoEuro=0;
  for(const id of euroAssets){
    precios[id]+=(Math.random()-0.5)*2;
    sumEuro+=precios[id]*pesosEuro[id];
    totalPesoEuro+=pesosEuro[id];
  }
  let sumDollar=0,totalPesoDollar=0;
  for(const id of dollarAssets){
    precios[id]+=(Math.random()-0.5)*2;
    sumDollar+=precios[id]*pesosDollar[id];
    totalPesoDollar+=pesosDollar[id];
  }
  return (sumEuro/totalPesoEuro - sumDollar/totalPesoDollar)+100;
}

function initCFD(){
  cfdChart = LightweightCharts.createChart(document.getElementById('tv_cfd'), {
    width: document.getElementById('tv_cfd').clientWidth,
    height: document.getElementById('tv_cfd').clientHeight,
    layout: { backgroundColor:'#1e1e1e', textColor:'#fff' },
    grid: { vertLines:{color:'#444'}, horzLines:{color:'#444'} },
    crosshair:{mode:0},
    rightPriceScale:{borderColor:'#444'},
    timeScale:{borderColor:'#444', rightOffset:5, barSpacing:15, lockVisibleTimeRangeOnResize:false, fixRightEdge:true, rightBarStaysOnScroll:true}
  });

  cfdSeries = cfdChart.addCandlestickSeries({ upColor:'#0f0', downColor:'#f00', borderVisible:false, wickUpColor:'#0f0', wickDownColor:'#f00' });

  for(let i=0;i<50;i++){
    const price = calcularCFD();
    cfdData.push({time:i, open:price-0.2, high:price+0.2, low:price-0.3, close:price});
  }
  cfdSeries.setData(cfdData);
}

async function updateCFD(){
  const price = calcularCFD();
  const last = cfdData[cfdData.length-1];
  const newBar = {time:last.time+1, open:last.close, high:price+0.2, low:price-0.2, close:price};
  cfdData.push(newBar);
  if(cfdData.length>50) cfdData.shift();
  cfdSeries.setData(cfdData);
}

function updateCFDInterval(){ cfdInterval=parseInt(document.getElementById("cfd_interval").value); }
function updateCFDStyle(){ cfdStyle=document.getElementById("cfd_style").value; }

// ===== IA SIMULADA =====
function logConsole(text){ 
  const c=document.getElementById("ia-console"); 
  c.innerText+="\n"+text; 
  c.scrollTop=c.scrollHeight; 
}
setInterval(()=>{
  const msgs=[
    "EUR/USD detecta soporte en 1.0950 ðŸ“Š",
    "DXY y Euro correlaciÃ³n negativa âš–ï¸",
    "BTC sigue alcista ðŸš€",
    "S&P500 y Nasdaq sincronizados ðŸ“ˆ",
    "Analizando resistencias EUR/USD 1.1000"
  ];
  logConsole(msgs[Math.floor(Math.random()*msgs.length)]);
},8000);

// ===== ALERTAS =====
function showAlert(msg){ 
  const box=document.getElementById("alertBox"); 
  const div=document.createElement("div"); 
  div.className="alert"; 
  div.innerText=msg; 
  box.appendChild(div); 
  setTimeout(()=>div.remove(),5000);
}
setInterval(()=>{ if(Math.random()<0.2) showAlert("âš¡ Alerta CFD rompe soporte/resistencia!"); },7000);

// ===== NOTICIAS =====
async function fetchNewsRealtime(query="EUR/USD"){
  try{
    const url=`https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&language=es&sortBy=publishedAt&apiKey=pub_b272af150959422caa98464f57f2f31b`;
    const res=await fetch(url);
    const json=await res.json();
    return json.articles||[];
  }catch(e){console.error(e); return [];}
}

function displayNews(beforeAfter, articles){
  const container=document.getElementById(beforeAfter==="before"?"news-before":"news-after");
  container.innerHTML=`<h3>Noticias ${beforeAfter==="before"?"Antes":"DespuÃ©s"}</h3>`;
  articles.forEach(a=>{
    const div=document.createElement("div"); 
    div.className="news";
    div.innerHTML=`<span>${new Date(a.publishedAt).toLocaleTimeString()}:</span> ${a.title}<br><small>${a.source.name}</small>`;
    container.appendChild(div);
  });
}

async function updateNewsPanels(){
  const news=await fetchNewsRealtime("EUR/USD");
  displayNews("before",news.slice(0,5));
  displayNews("after",news.slice(5,10));
}

initCFD();
setInterval(updateCFD,2000);
updateNewsPanels();
setInterval(updateNewsPanels,30000);
</script>
</body>
</html>
