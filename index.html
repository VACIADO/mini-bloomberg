<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini Bloomberg Pro</title>
<style>
body { 
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #121212;
  color: #fff;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
  justify-content: center;
}
.panel {
  border: 1px solid #444;
  border-radius: 8px;
  background-color: #1e1e1e;
  box-sizing: border-box;
  padding: 10px;
  flex: 1 1 45%;
  min-width: 300px;
  display: flex;
  flex-direction: column;
  height: 420px;
}
h2 {
  margin: 0 0 5px 0;
  text-align: center;
  font-size: 1.1rem;
}
.tradingview-widget-container {
  flex: 1;
  margin-top: 5px;
  border-radius: 6px;
  overflow: hidden;
}
#ia-console {
  width: 100%;
  background: #000;
  color: #0f0;
  font-family: monospace;
  padding: 6px;
  height: 120px;
  overflow-y: auto;
  font-size: 0.8rem;
  margin-top: 8px;
  border-radius: 4px;
  border: 1px solid #444;
}
.cfd-controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
}
.cfd-controls select {
  background: #333;
  color: #fff;
  border: 1px solid #555;
  border-radius: 4px;
  padding: 3px;
  font-size: 0.9rem;
}
</style>
</head>
<body>

<!-- PANEL EURO -->
<div class="panel">
<h2>Euro / Correlados</h2>
<div class="tradingview-widget-container" id="tv_eurodolar"></div>
<div class="tradingview-widget-container" id="tv_bono_eu"></div>
<div class="tradingview-widget-container" id="tv_oro"></div>
<div class="tradingview-widget-container" id="tv_brent"></div>
<div class="tradingview-widget-container" id="tv_btc"></div>
</div>

<!-- PANEL DXY -->
<div class="panel">
<h2>DXY / Correlados</h2>
<div class="tradingview-widget-container" id="tv_dxy"></div>
<div class="tradingview-widget-container" id="tv_bono_us"></div>
<div class="tradingview-widget-container" id="tv_nasdaq"></div>
<div class="tradingview-widget-container" id="tv_sp500"></div>
<div class="tradingview-widget-container" id="tv_vix"></div>
</div>

<!-- PANEL CFD -->
<div class="panel">
<h2>CFD – Polmillone</h2>

<div class="cfd-controls">
<select id="cfd_style" onchange="updateCFDStyle()">
<option value="candles">Velas</option>
<option value="bars">Barras</option>
<option value="line">Línea</option>
</select>
</div>

<div id="tv_cfd"></div>
<div id="ia-console">IA conectada al flujo macro...</div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
function crearWidget(symbol, id) {
  new TradingView.widget({
    container_id: id,
    symbol: symbol,
    interval: "60",
    timezone: "Europe/Madrid",
    theme: "dark",
    locale: "es",
    hide_top_toolbar: true,
    width: "100%",
    height: "100%"
  });
}

crearWidget("FX:EURUSD","tv_eurodolar");
crearWidget("INDEX:EXY","tv_bono_eu");
crearWidget("OANDA:XAUUSD","tv_oro");
crearWidget("TVC:UKOIL","tv_brent");
crearWidget("BINANCE:BTCUSDT","tv_btc");
crearWidget("INDEX:DXY","tv_dxy");
crearWidget("US10Y","tv_bono_us");
crearWidget("NASDAQ:NDX","tv_nasdaq");
crearWidget("OANDA:SPX500USD","tv_sp500");
crearWidget("CAPITALCOM:VIX","tv_vix");

let cfdData=[], cfdPrice=100, cfdStyle="candles";

function calcularFuerzaMercado(){
  const euro = Math.random()*0.4 + Math.random()*0.3 + Math.random()*0.3;
  const dolar = Math.random()*0.5 + Math.random()*0.3 + Math.random()*0.2;
  return euro - dolar;
}

function drawCFD(){
  const c=document.getElementById("tv_cfd");
  c.innerHTML="";
  const cv=document.createElement("canvas");
  cv.width=c.clientWidth; cv.height=c.clientHeight;
  c.appendChild(cv);
  const x=cv.getContext("2d");

  const max=Math.max(...cfdData), min=Math.min(...cfdData);
  cfdData.forEach((v,i)=>{
    const px=i*(cv.width/cfdData.length);
    const py=(max-v)/(max-min)*cv.height;
    x.fillStyle=i&&v>cfdData[i-1]?"#0f0":"#f00";
    x.fillRect(px,py,5,cv.height-py);
  });
}

function updateCFD(){
  const fuerza=calcularFuerzaMercado();
  cfdPrice+=fuerza;
  cfdData.push(cfdPrice);
  if(cfdData.length>50)cfdData.shift();
  drawCFD();
}
setInterval(updateCFD,2000);

function logIA(){
  const f=calcularFuerzaMercado();
  let msg="Mercado lateral.";
  if(f>0.8) msg="Dominio EURO – riesgo activo.";
  else if(f<-0.8) msg="Dominio DÓLAR – flujo defensivo.";
  document.getElementById("ia-console").innerText+="\nIA: "+msg;
}
setInterval(logIA,8000);
</script>
</body>
</html>
